---
title: 闭包的作用和原理
tags:
  - 面试
  - 基础
categories:
  - 面试
---

# 闭包的作用和原理

## 相关问题

- 什么是闭包
- 闭包的应用

## 回答关键点

`作用域` `引用` `函数`

作用：能够在函数定义的作用域外，使用函数定义作用域内的局部变量，并且不会污染全局。

原理：基于词法作用域链和垃圾回收机制，通过维持函数作用域的引用，让函数作用域可以在当前作用域外被访问到。

## 知识点深入

### 1. 作用域

- **作用域**：用于确定在何处以及如何查找变量（标识符）的一套规则。
- **词法作用域**：词法作用域是**定义在词法阶段的作用域**。词法作用域是由写代码时将代码和块作用域写在哪里来决定的，因此当词法作用域处理代码是会保持作用域不变(大部分情况)。
- **块作用域**：指的是变量和函数不仅可以属于所处的作用域，也可以属于某个代码块（通常用{}包裹）。常见的块级作用域有 with，try/catch，let，const 等。
- **函数作用域**：属于这个函数的全部变量都可以在整个函数范围内使用及复用（包括嵌套作用域）。
- **作用域链**：查找变量时，先从当前作用域开始查找，如果没有找到，就会到父级(词法层面上的父级)作用域中查找，一直找到全局作用域。作用域链正是包含这些作用域的列表。

### 2. 什么是闭包

> 当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使是函数在当前词法作用域外执行。 ——《你不知道的 JavaScript》

```
function foo() {  var a = "hzfe";  function bar() {    console.log(a);  }  return bar;}var baz = foo();baz(); // hzfe
```

在这个例子中，函数 bar 作为返回值返回后，在自己定义的词法作用域以外的地方执行。一般来说，在函数 foo 执行后，通常会期待函数 foo 的整个内部作用域被引擎回收机制销毁。而闭包可以阻止这件事情的发生。事实上内部作用域依然存在，因为函数 bar 本身在使用，所以并不会被回收。

在 JavaScript 中，**每当创建一个函数，闭包就会在函数创建的同时被创建出来**。

### 3. 闭包的应用

无论何时何地，如果**将函数作为返回值，就会看到闭包在这些函数中的应用**。在定时器，事件监听器，ajax 请求，跨窗口通信，web workers 或者任何其他的异步/同步任务中，只要**使用了回调函数，实际上就是使用闭包**。使用闭包的例子可以参考[实现节流防抖函数](https://febook.hzfe.org/awesome-interview/book2/coding-throttle-debounce)。

**TIPS: 闭包与执行函数关系**

```
var a = "hzfe";(function IIFE() {  console.log(a);})();
```

通常认为立即执行函数（IIFE）是典型的观察闭包的典型例子，但严格来说并不是。**虽然创建了闭包，但没有体现出闭包的作用**。因为函数并不是在它本身的词法作用域以外执行的。 它在定义时所在的作用域中执行，而非外部作用域。

## 参考资料

1. [闭包 MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures)
2. [垃圾回收机制](https://febook.hzfe.org/awesome-interview/book2/browser-garbage)
3. [你不知道的 JavaScript（上卷）](https://github.com/getify/You-Dont-Know-JS)
4. [维基百科-闭包](<https://zh.wikipedia.org/wiki/%E9%97%AD%E5%8C%85_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)>)
